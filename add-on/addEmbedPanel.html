<!DOCTYPE html>
<html>
  <head>
    <?!= include("styles.html") ?>
  </head>
  <body>
    <fieldset>
      <label for="type">Select embed type:</label>
      <select id="type">
        <option value="image">Image</option>
        <option value="twitter">Tweet</option>
        <option value="sidechain">Graphic embed</option>
        <option value="youtube">YouTube Video</option>
        <option value="showmore">Show more button</option>
      </select>
    </fieldset>
    
    <form id="twitter">
      <h2>Twitter</h2>
      <fieldset>
        <label for="tweet">Tweet URL</label>
        <input id="tweet">
      </fieldset>
      <button class="add-embed">Add tweet</button>
    </form>
    
    <form id="image">
      <h2>Image</h2>
      <fieldset>
        <label for="src">Image filename</label>
        <input id="src">
      </fieldset>
      <fieldset>
        <input type="checkbox" id="narrow">
        Narrow image?
      </fieldset>
      <fieldset>
        <label for="credit">Credit</label>
        <input id="credit">
      </fieldset>
      <fieldset>
        <label for="link">Link</label>
        <input id="link">
      </fieldset>
      <button class="add-embed">Add image</button>
    </form>
    
    <form id="sidechain">
      <h2>Graphic embed</h2>
      <fieldset>
        <label for="src">Embed URL</label>
        <input id="src">
      </fieldset>
      <button class="add-embed">Add graphic</button>
    </form>
    
    <form id="youtube">
      <h2>YouTube video</h2>
      <p>
      Paste in the ID or the full YouTube URL. The ID is the gibberish that comes after the "?v=" in the URL.
      <fieldset>
        <label for="video">Video ID</label>
        <input id="video">
      </fieldset>
      <button class="add-embed">Add video</button>
    </form>
    
    <form id="showmore">
      <h2>Show More button</h2>
      <fieldset>
        <label for="text">Button text (optional)</label>
        <input id="text">
      </fieldset>
      <button class="add-embed">Add button</button>
    </form>
    
    <script>
var typeSelect = document.querySelector("#type");
var forms = document.querySelectorAll("form");
var onSelectType = function() {
  for (var form of forms) {
    if (form.id == typeSelect.value) {
      form.removeAttribute("hidden");
    } else {
      form.setAttribute("hidden", "");
    }
  }
};
typeSelect.addEventListener("change", onSelectType);
onSelectType();

var onClickSubmit = function(e) {
  e.preventDefault();
  var button = this;
  var form = button.closest("form");
  var inputs = form.querySelectorAll("input, select");
  var data = {
    type: typeSelect.value
  };
  for (var input of inputs) {
    data[input.id] = input.type == "checkbox" ? input.checked * 1 : input.value;
  }
  google.script.run
    .withSuccessHandler(function() {
      google.script.host.close();
    })
    .addEmbed(data);
}
var buttons = document.querySelectorAll(".add-embed");
for (var button of buttons) {
  button.addEventListener("click", onClickSubmit);
}
    </script>
  </body>
</html>
